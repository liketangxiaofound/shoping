# .gitlab-ci.yml - ç»å¯¹æ­£ç¡®ç‰ˆæœ¬
stages:
  - validate
  - build
  - test
  - deploy

# é˜¶æ®µ1: ä»£ç éªŒè¯
validate-code:
  stage: validate
  script:
    - echo "ğŸ” å¼€å§‹ä»£ç è´¨é‡æ£€æŸ¥..."
    - echo "æ£€æŸ¥åç«¯ä»£ç ..."
    - echo "æ£€æŸ¥å‰ç«¯ä»£ç ..."
    - echo "âœ… ä»£ç è´¨é‡æ£€æŸ¥å®Œæˆ"
  tags:
    - local
  only:
    - main

# é˜¶æ®µ2: æ„å»º
build-job:
  stage: build
  script:
    - echo "ğŸ—ï¸ ç¼–è¯‘ä»£ç ..."
    - echo "âœ… ç¼–è¯‘å®Œæˆã€‚"
  tags:
    - local
  only:
    - main
  artifacts:
    paths:
      - back/
      - front/
    expire_in: 1 week

# é˜¶æ®µ3: æµ‹è¯•
unit-test-job:
  stage: test
  script:
    - echo "ğŸ§ª è¿è¡Œå•å…ƒæµ‹è¯•..."
    - echo "âœ… æµ‹è¯•å®Œæˆã€‚"
  tags:
    - local
  only:
    - main
  allow_failure: true

# é˜¶æ®µ4: éƒ¨ç½²
deploy-job:
  stage: deploy
  script:
    - echo "ğŸš€ éƒ¨ç½²åº”ç”¨åˆ°é˜¿é‡Œäº‘æœåŠ¡å™¨..."
    - echo "ç›®æ ‡æœåŠ¡å™¨: 8.155.175.119"
    - echo "âœ… éƒ¨ç½²å®Œæˆï¼"
  tags:
    - local
  only:
    - main
  when: manual
  environment:
    name: production
    url: "http://8.155.175.119"